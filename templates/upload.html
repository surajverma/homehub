{% extends "base.html" %}
{% block content %}
<div class="mx-auto">
    <h2 class="text-xl font-bold mb-4">Shared Cloud</h2>
    <form method="POST" enctype="multipart/form-data" class="mb-4 card p-4">
        <input type="file" name="files" multiple required class="mb-2">
        <input type="hidden" name="creator" id="creator">
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>
    <ul>
        {% for file in files %}
        <li class="card p-4 mb-2 flex justify-between items-center">
            <div class="flex-1">
                <a href="/uploads/{{ file.filename }}" class="font-semibold text-blue-700">{{ file.filename }}</a>
                <div class="text-xs text-gray-500">By {{ file.creator }} at {{ file.upload_time.strftime('%Y-%m-%d %H:%M') }}</div>
            </div>
            <div class="flex gap-2">
                <a href="/uploads/preview/{{ file.filename }}" target="_blank" rel="noopener noreferrer" class="btn btn-success" aria-label="Preview {{ file.filename }} in new tab">
                    <i class="fa-solid fa-eye" aria-hidden="true"></i> Preview
                </a>
                <a href="/uploads/{{ file.filename }}" class="btn btn-primary">
                    <i class="fa-solid fa-download" aria-hidden="true"></i> Download
                </a>
                <form method="POST" action="/upload/delete/{{ file.id }}" class="delete-form" data-creator="{{ file.creator }}">
                    <input type="hidden" name="user">
                    <button type="submit" class="btn btn-danger">Delete</button>
                </form>
            </div>
        </li>
        {% endfor %}
    </ul>
</div>
<script>
document.getElementById('creator').value = localStorage.getItem('username');
document.querySelectorAll('input[name="user"]').forEach(i=> i.value = localStorage.getItem('username'));
// Hide delete for non-owners
(function(){
    const adminName='{{ config.admin_name }}';
    const current=localStorage.getItem('username');
    document.querySelectorAll('.delete-form').forEach(f=>{
        const c=f.getAttribute('data-creator');
        if(!(current===c||current===adminName||current==='Administrator'||current==='admin')) f.style.display='none';
    });
})();
</script>
{% endblock %}
